<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Fire Tournament</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #4361ee;
  --secondary: #3f37c9;
  --success: #4cc9f0;
  --danger: #f72585;
  --warning: #f8961e;
  --dark: #212529;
  --light: #f8f9fa;
  --card-bg: #ffffff;
  --body-bg: #f5f7fa;
  --text-dark: #343a40;
  --text-light: #6c757d;
  --verified-badge: #1da1f2;
  --banned-bg: #1a1a2e;
  --banned-text: #e94560;
}

body {
  background: var(--body-bg);
  color: var(--text-dark);
  font-family: 'Poppins', sans-serif;
  padding-bottom: 80px; /* Space for mobile bottom nav */
}

.navbar {
  background: var(--card-bg);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.brand {
  color: var(--primary);
  font-weight: 800;
  font-size: 1.5rem;
  font-family: 'Poppins', sans-serif;
}

.btn-primary {
  background: var(--primary);
  border: none;
  padding: 8px 16px;
  transition: all 0.3s;
  font-weight: 500;
}

.btn-primary:hover {
  background: var(--secondary);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
}

.btn-outline-primary {
  color: var(--primary);
  border-color: var(--primary);
}

.btn-outline-primary:hover {
  background: var(--primary);
  color: white;
}

/* Tournament Cards */
.tournament-card {
  border: none;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  margin-bottom: 20px;
  position: relative;
  background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
}

.tournament-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.15);
}

.tournament-card.premium {
  border: 2px solid var(--warning);
  background: linear-gradient(135deg, #fff9e6 0%, #ffefc2 100%);
}

.tournament-card.premium .card-header {
  background: linear-gradient(135deg, var(--warning), #ff9500);
}

.card-header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  font-weight: 600;
  padding: 12px 15px;
  position: relative;
  overflow: hidden;
}

.card-header::after {
  content: "";
  position: absolute;
  top: -50%;
  right: -50%;
  width: 100%;
  height: 200%;
  background: rgba(255,255,255,0.1);
  transform: rotate(30deg);
  pointer-events: none;
}

.card-body {
  padding: 20px;
}

.verified-badge {
  color: var(--verified-badge);
  margin-left: 5px;
}

.fee-badge {
  background: var(--success);
  color: white;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 600;
}

.premium-badge {
  background: var(--warning);
  color: white;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 600;
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 1;
}

.date-time {
  color: var(--text-light);
  font-size: 0.9rem;
}

/* Auth Modal */
.auth-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(5px);
}

.auth-card {
  background: white;
  border-radius: 12px;
  width: 100%;
  max-width: 450px;
  padding: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  transform: scale(0.95);
  opacity: 0;
  animation: modalEnter 0.3s forwards;
}

@keyframes modalEnter {
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.close-modal {
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--text-light);
  transition: all 0.2s;
}

.close-modal:hover {
  color: var(--danger);
  transform: rotate(90deg);
}

/* Dashboard */
.wallet-card {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
  position: relative;
  overflow: hidden;
}

.wallet-card::before {
  content: "";
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  pointer-events: none;
}

.wallet-amount {
  font-size: 2rem;
  font-weight: 700;
}

/* Utility */
.pill {
  padding: 0.25rem 0.8rem;
  border-radius: 999px;
  font-size: 0.85rem;
  display: inline-block;
  background: rgba(67, 97, 238, 0.1);
  color: var(--primary);
  font-weight: 500;
}

.status-pending {
  background: #fff3cd;
  color: #856404;
}

.status-approved {
  background: #d4edda;
  color: #155724;
}

.status-rejected {
  background: #f8d7da;
  color: #721c24;
}

/* Banned User Screen */
.banned-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--banned-bg);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: white;
  text-align: center;
  padding: 20px;
  display: none;
}

.banned-icon {
  font-size: 5rem;
  color: var(--banned-text);
  margin-bottom: 20px;
  animation: shake 0.5s infinite alternate;
}

@keyframes shake {
  from {
    transform: rotate(-10deg);
  }
  to {
    transform: rotate(10deg);
  }
}

.contact-support {
  margin-top: 30px;
  background: rgba(255,255,255,0.1);
  padding: 20px;
  border-radius: 10px;
  max-width: 500px;
  width: 100%;
}

.support-sticker {
  font-size: 2rem;
  margin: 0 5px;
  display: inline-block;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* Hide elements initially */
#dash, #home-dash, #auth-modal {
  display: none;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .auth-card {
    width: 90%;
    padding: 20px;
  }
  
  .wallet-amount {
    font-size: 1.5rem;
  }
  
  .tournament-card {
    margin-bottom: 15px;
  }
  
  .navbar-nav {
    display: none;
  }
  
  .mobile-menu-btn {
    display: block !important;
  }
  
  .tournament-image {
    height: 120px;
  }
  
  .card-body {
    padding: 15px;
  }
  
  .btn {
    padding: 8px 12px;
    font-size: 0.9rem;
  }
  
  .wallet-card {
    padding: 15px;
  }
}

/* Premium Animations */
.pulse {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(244, 180, 0, 0.4);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(244, 180, 0, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(244, 180, 0, 0);
  }
}

/* Floating action button */
.fab {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  background: var(--primary);
  color: white;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.5rem;
  box-shadow: 0 5px 20px rgba(67, 97, 238, 0.4);
  cursor: pointer;
  z-index: 100;
  transition: all 0.3s;
}

.fab:hover {
  transform: translateY(-3px) scale(1.1);
  box-shadow: 0 8px 25px rgba(67, 97, 238, 0.5);
}

/* Notification System */
.notification-badge {
  position: relative;
  margin-right: 15px;
}

.notification-count {
  position: absolute;
  top: -5px;
  right: -5px;
  background: var(--danger);
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 0.7rem;
  font-weight: bold;
}

.notification-dropdown {
  position: absolute;
  top: 40px;
  right: 0;
  width: 350px;
  max-height: 500px;
  overflow-y: auto;
  background: white;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  z-index: 1000;
  display: none;
}

.notification-item {
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
  transition: all 0.2s;
}

.notification-item:hover {
  background: #f8f9fa;
}

.notification-item.unread {
  background: #f0f7ff;
}

.notification-title {
  font-weight: 600;
  margin-bottom: 5px;
}

.notification-time {
  font-size: 0.8rem;
  color: var(--text-light);
}

.notification-category {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.7rem;
  margin-right: 5px;
}

.category-info {
  background: #d1ecf1;
  color: #0c5460;
}

.category-warning {
  background: #fff3cd;
  color: #856404;
}

.category-success {
  background: #d4edda;
  color: #155724;
}

.category-danger {
  background: #f8d7da;
  color: #721c24;
}

/* Tournament Image Preview */
.tournament-image {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-bottom: 1px solid #eee;
}

/* Wallet Transaction History */
.transaction-history {
  max-height: 300px;
  overflow-y: auto;
}

.transaction-item {
  padding: 10px 15px;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.transaction-amount {
  font-weight: 600;
}

.transaction-amount.positive {
  color: #28a745;
}

.transaction-amount.negative {
  color: #dc3545;
}

.transaction-details {
  font-size: 0.9rem;
  color: var(--text-light);
}

/* Mobile Bottom Navigation */
.mobile-bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: white;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
  display: none;
  z-index: 1000;
}

.mobile-bottom-nav-item {
  flex: 1;
  text-align: center;
  padding: 12px 0;
  color: var(--text-light);
  text-decoration: none;
  font-size: 0.8rem;
  transition: all 0.2s;
}

.mobile-bottom-nav-item.active {
  color: var(--primary);
}

.mobile-bottom-nav-item i {
  display: block;
  font-size: 1.2rem;
  margin-bottom: 4px;
}

.mobile-bottom-nav-item:hover {
  color: var(--primary);
}

@media (max-width: 768px) {
  .mobile-bottom-nav {
    display: flex;
  }
  
  main {
    padding-bottom: 70px;
  }
  
  .fab {
    bottom: 80px;
  }
}

/* Mobile Menu */
.mobile-menu-btn {
  display: none;
  border: none;
  background: none;
  font-size: 1.2rem;
  color: var(--primary);
}

.mobile-menu {
  position: fixed;
  top: 0;
  left: -100%;
  width: 80%;
  max-width: 300px;
  height: 100%;
  background: white;
  box-shadow: 2px 0 10px rgba(0,0,0,0.1);
  z-index: 1100;
  transition: all 0.3s;
  padding: 20px;
  overflow-y: auto;
}

.mobile-menu.show {
  left: 0;
}

.mobile-menu-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1050;
  display: none;
}

.mobile-menu-overlay.show {
  display: block;
}

.mobile-menu-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.mobile-menu-close {
  font-size: 1.5rem;
  background: none;
  border: none;
  color: var(--danger);
}

.mobile-menu-item {
  display: block;
  padding: 12px 0;
  color: var(--text-dark);
  text-decoration: none;
  border-bottom: 1px solid #eee;
  transition: all 0.2s;
}

.mobile-menu-item i {
  margin-right: 10px;
  width: 20px;
  text-align: center;
}

.mobile-menu-item:hover {
  color: var(--primary);
  padding-left: 5px;
}

/* Form inputs */
.form-control, .form-select {
  border-radius: 8px;
  padding: 10px 15px;
  border: 1px solid #ddd;
  transition: all 0.3s;
}

.form-control:focus, .form-select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
}

/* Payment method buttons */
.payment-method {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  border-radius: 8px;
  transition: all 0.2s;
}

.payment-method img {
  width: 20px;
  height: 20px;
  object-fit: contain;
  margin-right: 5px;
}

.payment-method.active {
  border-color: var(--primary);
  background-color: rgba(67, 97, 238, 0.1);
}

/* Table responsive */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Emoji Styles */
.emoji {
  font-size: 1.2em;
  margin-right: 5px;
}

/* Loading spinner */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Empty state */
.empty-state {
  text-align: center;
  padding: 30px;
  color: var(--text-light);
}

.empty-state i {
  font-size: 3rem;
  margin-bottom: 15px;
  color: #ddd;
}

/* Swipeable tabs for mobile */
.swipe-tabs {
  display: flex;
  border-bottom: 1px solid #eee;
  margin-bottom: 15px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.swipe-tab {
  padding: 10px 15px;
  white-space: nowrap;
  border-bottom: 2px solid transparent;
  color: var(--text-light);
  font-weight: 500;
  transition: all 0.2s;
}

.swipe-tab.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
}

/* Touch feedback */
.btn, .mobile-bottom-nav-item, .mobile-menu-item {
  -webkit-tap-highlight-color: transparent;
}

/* Prevent zoom on input focus */
@media screen and (-webkit-min-device-pixel-ratio:0) {
  select:focus, textarea:focus, input:focus {
    font-size: 16px;
  }
}
</style>
</head>
<body>

<!-- Banned User Screen -->
<div id="banned-screen" class="banned-screen">
  <div class="banned-icon">
    <i class="fas fa-ban"></i>
  </div>
  <h2 class="mb-3">আপনার অ্যাকাউন্ট বন্ধ করা হয়েছে!</h2>
  <p class="mb-4">আপনার অ্যাকাউন্টে আমাদের নীতিমালা লঙ্ঘন করা হয়েছে বলে সনাক্ত করা হয়েছে।</p>
  
  <div class="contact-support">
    <h5 class="mb-3">সাপোর্ট টিমের সাথে যোগাযোগ করুন</h5>
    <div class="mb-3">
      <span class="support-sticker">😢</span>
      <span class="support-sticker">📞</span>
      <span class="support-sticker">✉️</span>
      <span class="support-sticker">🆘</span>
    </div>
    <p>ইমেইল: support@freefirearena.com</p>
    <p>ফোন: 017XX-XXXXXX</p>
    <button id="btn-logout-banned" class="btn btn-outline-light mt-3">
      <i class="fas fa-sign-out-alt me-2"></i> লগআউট
    </button>
  </div>
</div>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobile-menu">
  <div class="mobile-menu-header">
    <h5 class="mb-0"><i class="fas fa-fire text-primary me-2"></i> FreeFire Arena</h5>
    <button class="mobile-menu-close" id="mobile-menu-close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div id="mobile-menu-content">
    <a href="#" class="mobile-menu-item" data-section="home">
      <i class="fas fa-home"></i> হোম
    </a>
    <a href="#" class="mobile-menu-item" data-section="tournaments">
      <i class="fas fa-trophy"></i> টুর্নামেন্ট
    </a>
    <a href="#" class="mobile-menu-item" data-section="wallet">
      <i class="fas fa-wallet"></i> ওয়ালেট
    </a>
    <a href="#" class="mobile-menu-item" data-section="profile">
      <i class="fas fa-user"></i> প্রোফাইল
    </a>
    <a href="#" class="mobile-menu-item" data-section="notifications">
      <i class="fas fa-bell"></i> নোটিফিকেশন
    </a>
    <a href="#" class="mobile-menu-item" data-section="support">
      <i class="fas fa-headset"></i> সাপোর্ট
    </a>
    <a href="#" class="mobile-menu-item text-danger" id="mobile-menu-logout">
      <i class="fas fa-sign-out-alt"></i> লগআউট
    </a>
  </div>
</div>

<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand brand" href="#">
      <i class="fas fa-fire"></i> FreeFire Arena
    </a>
    
    <button class="mobile-menu-btn" id="mobile-menu-btn">
      <i class="fas fa-bars"></i>
    </button>
    
    <div class="ms-auto d-flex align-items-center">
      <!-- Notification Bell -->
      <div class="notification-badge me-3 d-none" id="notification-bell">
        <i class="fas fa-bell fa-lg"></i>
        <span class="notification-count d-none">0</span>
        <div class="notification-dropdown" id="notification-dropdown">
          <div class="notification-header p-3 border-bottom">
            <h5 class="mb-0">Notifications</h5>
          </div>
          <div id="notification-list">
            <!-- Notifications will be loaded here -->
          </div>
          <div class="notification-footer p-2 text-center">
            <a href="#" id="mark-all-read">Mark all as read</a>
          </div>
        </div>
      </div>
      
      <button id="btn-login-show" class="btn btn-outline-primary me-2">
        <i class="fas fa-sign-in-alt"></i> <span class="d-none d-md-inline">Login/Register</span>
      </button>
      <button id="btn-logout-dash" class="btn btn-outline-secondary d-none">
        <i class="fas fa-sign-out-alt"></i> <span class="d-none d-md-inline">Logout</span>
      </button>
    </div>
  </div>
</nav>

<main class="container my-4">

<!-- HOME PAGE TOURNAMENT GRID -->
<div id="home-dash">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Upcoming Tournaments</h3>
    <div class="d-flex">
      <input type="text" id="search-tournaments" class="form-control me-2" placeholder="Search tournaments...">
      <select id="filter-fee" class="form-select d-none d-md-block" style="width: 120px;">
        <option value="all">All Fees</option>
        <option value="0-100">0-100৳</option>
        <option value="101-500">101-500৳</option>
        <option value="501+">501+৳</option>
      </select>
    </div>
  </div>
  
  <!-- Mobile filter tabs -->
  <div class="swipe-tabs d-md-none mb-3">
    <div class="swipe-tab active" data-filter="all">All</div>
    <div class="swipe-tab" data-filter="0-100">0-100৳</div>
    <div class="swipe-tab" data-filter="101-500">101-500৳</div>
    <div class="swipe-tab" data-filter="501+">501+৳</div>
  </div>
  
  <div class="row" id="tournaments-grid">
    <!-- Tournament cards will be inserted here -->
  </div>
  
  <!-- Loading indicator -->
  <div id="tournaments-loading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading tournaments...</p>
  </div>
</div>

<!-- AUTH MODAL -->
<div id="auth-modal" class="auth-modal">
  <div class="auth-card position-relative">
    <span class="close-modal">&times;</span>
    <h2 class="text-center mb-4">লগইন / রেজিস্টার</h2>
    <div class="mb-3">
      <label for="name" class="form-label">আপনার নাম</label>
      <input id="name" class="form-control" placeholder="আপনার পুরো নাম লিখুন"/>
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">ইমেইল</label>
      <input id="email" type="email" class="form-control" placeholder="আপনার ইমেইল ঠিকানা"/>
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">পাসওয়ার্ড</label>
      <input id="password" type="password" class="form-control" placeholder="কমপক্ষে ৬ অক্ষরের পাসওয়ার্ড"/>
    </div>
    <div class="mb-4">
      <label for="role-select" class="form-label">আপনার ভূমিকা</label>
      <select id="role-select" class="form-select">
        <option value="player">Player</option>
        <option value="organizer">Organizer</option>
      </select>
    </div>
    <div class="d-grid gap-2">
      <button id="btn-register" class="btn btn-primary">
        <i class="fas fa-user-plus"></i> Register
      </button>
      <button id="btn-login" class="btn btn-outline-primary">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dash">
  <!-- Welcome and Wallet Section -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="wallet-card">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 id="welcome" class="mb-1">স্বাগতম!</h5>
            <div class="text-white-50">UID: <span id="uid" class="text-white"></span></div>
          </div>
          <div class="text-end">
            <div class="text-white-50 mb-1">আপনার ওয়ালেট</div>
            <div class="wallet-amount">৳<span id="wallet">0</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile swipe tabs for dashboard -->
  <div class="swipe-tabs d-md-none mb-3" id="dashboard-tabs">
    <div class="swipe-tab active" data-tab="player">Player</div>
    <div class="swipe-tab" data-tab="organizer">Organizer</div>
  </div>

  <div class="row g-4">
    <!-- PLAYER VIEW -->
    <div class="col-lg-6" id="player-view">
      <!-- Add Balance Section -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-wallet me-2"></i> ওয়ালেটে টাকা যোগ করুন
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label for="add-amount" class="form-label">টাকার পরিমাণ</label>
            <input id="add-amount" type="number" class="form-control" placeholder="যত টাকা যোগ করতে চান"/>
          </div>
          <div class="mb-3">
            <label for="add-number" class="form-label">মোবাইল নম্বর</label>
            <input id="add-number" type="text" class="form-control" placeholder="017XXXXXXXX"/>
          </div>
          <div class="mb-3">
            <label class="form-label">পেমেন্ট মাধ্যম</label>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-secondary flex-grow-1 payment-method active" data-method="bkash">
                <img src="https://via.placeholder.com/20/DF1462/FFFFFF?text=B" class="me-2"> bKash
              </button>
              <button class="btn btn-outline-secondary flex-grow-1 payment-method" data-method="nagad">
                <img src="https://via.placeholder.com/20/1C366B/FFFFFF?text=N" class="me-2"> Nagad
              </button>
              <button class="btn btn-outline-secondary flex-grow-1 payment-method" data-method="rocket">
                <img src="https://via.placeholder.com/20/5D2D86/FFFFFF?text=R" class="me-2"> Rocket
              </button>
            </div>
          </div>
          <button id="btn-add-balance" class="btn btn-primary w-100">
            <i class="fas fa-paper-plane me-2"></i> ব্যালেন্স রিকোয়েস্ট পাঠান
          </button>
          <div class="text-muted small mt-2">এডমিন অ্যাপ্রুভ করলেই আপনার ওয়ালেটে টাকা যোগ হবে</div>
        </div>
      </div>

      <!-- Wallet Transaction History -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-history me-2"></i> ট্রানজেকশন হিস্ট্রি
        </div>
        <div class="card-body p-0">
          <div class="transaction-history" id="transaction-history">
            <!-- Transactions will be loaded here -->
            <div class="empty-state">
              <i class="fas fa-exchange-alt"></i>
              <p>No transactions yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Player Tournaments Section -->
      <div class="card">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-trophy me-2"></i> টুর্নামেন্টসমূহ
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr>
                  <th>নাম</th>
                  <th>ফি</th>
                  <th>তারিখ</th>
                  <th>অ্যাকশন</th>
                </tr>
              </thead>
              <tbody id="tournaments-body">
                <!-- Tournaments will be loaded here -->
                <tr>
                  <td colspan="4" class="text-center py-4">
                    <i class="fas fa-trophy text-muted mb-2" style="font-size: 1.5rem;"></i>
                    <p class="mb-0">No tournaments joined yet</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ORGANIZER VIEW -->
    <div class="col-lg-6" id="organizer-view">
      <!-- Withdraw Section -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-money-bill-wave me-2"></i> টাকা উত্তোলন
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label for="withdraw-amount" class="form-label">টাকার পরিমাণ</label>
            <input id="withdraw-amount" type="number" class="form-control" placeholder="যত টাকা উত্তোলন করতে চান"/>
          </div>
          <div class="mb-3">
            <label for="withdraw-number" class="form-label">মোবাইল নম্বর</label>
            <input id="withdraw-number" type="text" class="form-control" placeholder="017XXXXXXXX"/>
          </div>
          <div class="mb-3">
            <label class="form-label">পেমেন্ট মাধ্যম</label>
            <select class="form-select" id="withdraw-method">
              <option value="bkash">bKash</option>
              <option value="nagad">Nagad</option>
              <option value="bank">Bank Account</option>
            </select>
          </div>
          <button id="btn-withdraw" class="btn btn-primary w-100">
            <i class="fas fa-hand-holding-usd me-2"></i> উত্তোলনের জন্য রিকোয়েস্ট করুন
          </button>
          <div class="text-muted small mt-2">এডমিন অ্যাপ্রুভ করলেই আপনার একাউন্টে টাকা চলে যাবে</div>
        </div>
      </div>

      <!-- Create Tournament Section -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-plus-circle me-2"></i> নতুন টুর্নামেন্ট তৈরি করুন
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label for="t-name" class="form-label">টুর্নামেন্টের নাম</label>
            <input id="t-name" class="form-control" placeholder="টুর্নামেন্টের নাম লিখুন"/>
          </div>
          <div class="mb-3">
            <label for="t-fee" class="form-label">এন্ট্রি ফি (৳)</label>
            <input id="t-fee" type="number" class="form-control" placeholder="টুর্নামেন্টের এন্ট্রি ফি"/>
          </div>
          <div class="mb-3">
            <label for="t-image" class="form-label">টুর্নামেন্ট ইমেজ URL</label>
            <input id="t-image" type="url" class="form-control" placeholder="https://example.com/image.jpg"/>
            <small class="text-muted">একটি আকর্ষণীয় ইমেজ URL প্রদান করুন</small>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="t-date" class="form-label">তারিখ</label>
              <input id="t-date" type="date" class="form-control"/>
            </div>
            <div class="col-md-6">
              <label for="t-time" class="form-label">সময়</label>
              <input id="t-time" type="time" class="form-control"/>
            </div>
          </div>
          <div class="mb-3">
            <label for="t-prize" class="form-label">পুরস্কার (ঐচ্ছিক)</label>
            <textarea id="t-prize" class="form-control" placeholder="পুরস্কারের বিবরণ লিখুন..."></textarea>
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="t-premium">
            <label class="form-check-label" for="t-premium">প্রিমিয়াম টুর্নামেন্ট (বিশেষ প্রদর্শন)</label>
          </div>
          <button id="btn-create-t" class="btn btn-primary w-100">
            <i class="fas fa-check-circle me-2"></i> টুর্নামেন্ট তৈরি করুন
          </button>
        </div>
      </div>

      <!-- Organizer Tournaments Section -->
      <div class="card">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-list-alt me-2"></i> আপনার টুর্নামেন্টসমূহ
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr>
                  <th>নাম</th>
                  <th>স্ট্যাটাস</th>
                  <th>প্লেয়ার</th>
                  <th>অ্যাকশন</th>
                </tr>
              </thead>
              <tbody id="organizer-tournaments-body">
                <!-- Organizer tournaments will be loaded here -->
                <tr>
                  <td colspan="4" class="text-center py-4">
                    <i class="fas fa-trophy text-muted mb-2" style="font-size: 1.5rem;"></i>
                    <p class="mb-0">No tournaments created yet</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</main>

<!-- Mobile Bottom Navigation -->
<div class="mobile-bottom-nav d-none" id="mobile-bottom-nav">
  <a href="#" class="mobile-bottom-nav-item active" data-section="home">
    <i class="fas fa-home"></i>
    <span>হোম</span>
  </a>
  <a href="#" class="mobile-bottom-nav-item" data-section="tournaments">
    <i class="fas fa-trophy"></i>
    <span>টুর্নামেন্ট</span>
  </a>
  <a href="#" class="mobile-bottom-nav-item" data-section="wallet">
    <i class="fas fa-wallet"></i>
    <span>ওয়ালেট</span>
  </a>
  <a href="#" class="mobile-bottom-nav-item" data-section="profile">
    <i class="fas fa-user"></i>
    <span>প্রোফাইল</span>
  </a>
</div>

<!-- Floating Action Button -->
<div class="fab" id="btn-scroll-top">
  <i class="fas fa-arrow-up"></i>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDX7Z8o5xVJa8cSHvaurZg4FkJvN8mJuto",
  authDomain: "free-fire-kingdom.firebaseapp.com",
  databaseURL: "https://free-fire-kingdom-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "free-fire-kingdom",
  storageBucket: "free-fire-kingdom.appspot.com",
  messagingSenderId: "889375613179",
  appId: "1:889375613179:web:b36bd72dd208b101e0d05e"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth(), db = firebase.database();

// UI refs
const authModal = document.getElementById('auth-modal');
const dash = document.getElementById('dash');
const homeDash = document.getElementById('home-dash');
const emailIn = document.getElementById('email');
const passIn = document.getElementById('password');
const roleSelect = document.getElementById('role-select');
const nameIn = document.getElementById('name');
const btnLogin = document.getElementById('btn-login');
const btnRegister = document.getElementById('btn-register');
const btnLogoutDash = document.getElementById('btn-logout-dash');
const btnLoginShow = document.getElementById('btn-login-show');
const closeModal = document.querySelector('.close-modal');
const welcome = document.getElementById('welcome');
const uidSpan = document.getElementById('uid');
const walletSpan = document.getElementById('wallet');
const playerView = document.getElementById('player-view');
const organizerView = document.getElementById('organizer-view');
const tournamentsBody = document.getElementById('tournaments-body');
const tournamentsGrid = document.getElementById('tournaments-grid');
const searchTournaments = document.getElementById('search-tournaments');
const filterFee = document.getElementById('filter-fee');
const bannedScreen = document.getElementById('banned-screen');
const btnLogoutBanned = document.getElementById('btn-logout-banned');
const btnScrollTop = document.getElementById('btn-scroll-top');
const notificationBell = document.getElementById('notification-bell');
const notificationDropdown = document.getElementById('notification-dropdown');
const notificationList = document.getElementById('notification-list');
const notificationCount = document.querySelector('.notification-count');
const markAllRead = document.getElementById('mark-all-read');
const transactionHistory = document.getElementById('transaction-history');
const organizerTournamentsBody = document.getElementById('organizer-tournaments-body');
const mobileMenuBtn = document.getElementById('mobile-menu-btn');
const mobileMenu = document.getElementById('mobile-menu');
const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
const mobileMenuClose = document.getElementById('mobile-menu-close');
const mobileBottomNav = document.getElementById('mobile-bottom-nav');
const mobileBottomNavItems = document.querySelectorAll('.mobile-bottom-nav-item');
const dashboardTabs = document.querySelectorAll('#dashboard-tabs .swipe-tab');
const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');
const mobileMenuLogout = document.getElementById('mobile-menu-logout');
const tournamentsLoading = document.getElementById('tournaments-loading');
const swipeTabs = document.querySelectorAll('.swipe-tabs .swipe-tab');

// Payment method selection
document.querySelectorAll('.payment-method').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.payment-method').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
  });
});

// Modal controls
btnLoginShow.addEventListener('click', () => {
  authModal.style.display = 'flex';
});

closeModal.addEventListener('click', () => {
  authModal.style.display = 'none';
});

window.addEventListener('click', (e) => {
  if (e.target === authModal) {
    authModal.style.display = 'none';
  }
});

// Mobile menu toggle
mobileMenuBtn.addEventListener('click', () => {
  mobileMenu.classList.add('show');
  mobileMenuOverlay.classList.add('show');
});

mobileMenuClose.addEventListener('click', () => {
  mobileMenu.classList.remove('show');
  mobileMenuOverlay.classList.remove('show');
});

mobileMenuOverlay.addEventListener('click', () => {
  mobileMenu.classList.remove('show');
  mobileMenuOverlay.classList.remove('show');
});

// Mobile bottom nav
mobileBottomNavItems.forEach(item => {
  item.addEventListener('click', function(e) {
    e.preventDefault();
    mobileBottomNavItems.forEach(i => i.classList.remove('active'));
    this.classList.add('active');
    
    // Scroll to section (simplified for demo)
    const section = this.getAttribute('data-section');
    if (section === 'home') {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
});

// Dashboard tabs for mobile
dashboardTabs.forEach(tab => {
  tab.addEventListener('click', function() {
    dashboardTabs.forEach(t => t.classList.remove('active'));
    this.classList.add('active');
    
    const tabName = this.getAttribute('data-tab');
    if (tabName === 'player') {
      playerView.style.display = 'block';
      organizerView.style.display = 'none';
    } else {
      playerView.style.display = 'none';
      organizerView.style.display = 'block';
    }
  });
});

// Mobile menu items
mobileMenuItems.forEach(item => {
  item.addEventListener('click', function(e) {
    e.preventDefault();
    mobileMenu.classList.remove('show');
    mobileMenuOverlay.classList.remove('show');
    
    const section = this.getAttribute('data-section');
    if (section === 'home') {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
});

// Mobile menu logout
mobileMenuLogout.addEventListener('click', () => {
  auth.signOut();
});

// Swipe tabs for tournament filters
swipeTabs.forEach(tab => {
  tab.addEventListener('click', function() {
    swipeTabs.forEach(t => t.classList.remove('active'));
    this.classList.add('active');
    
    const filter = this.getAttribute('data-filter');
    filterTournaments(filter);
  });
});

function filterTournaments(filter) {
  const cards = document.querySelectorAll('.tournament-card');
  
  cards.forEach(card => {
    const feeText = card.querySelector('.fee-badge, .premium-badge').textContent;
    const fee = parseInt(feeText.replace('৳', ''));
    
    let show = false;
    if (filter === 'all') show = true;
    else if (filter === '0-100') show = fee >= 0 && fee <= 100;
    else if (filter === '101-500') show = fee >= 101 && fee <= 500;
    else if (filter === '501+') show = fee >= 501;
    
    card.parentNode.style.display = show ? 'block' : 'none';
  });
}

// Notification system
notificationBell.addEventListener('click', (e) => {
  e.stopPropagation();
  notificationDropdown.style.display = notificationDropdown.style.display === 'block' ? 'none' : 'block';
});

// Close notification dropdown when clicking outside
document.addEventListener('click', () => {
  notificationDropdown.style.display = 'none';
});

markAllRead.addEventListener('click', async (e) => {
  e.preventDefault();
  const uid = auth.currentUser.uid;
  try {
    const notifications = await db.ref(`users/${uid}/notifications`).once('value');
    const updates = {};
    notifications.forEach(notification => {
      if (!notification.val().read) {
        updates[`users/${uid}/notifications/${notification.key}/read`] = true;
      }
    });
    await db.ref().update(updates);
    loadNotifications(uid);
  } catch (err) {
    console.error("Error marking notifications as read:", err);
  }
});

function loadNotifications(uid) {
  db.ref(`users/${uid}/notifications`).orderByChild('timestamp').limitToLast(20).on('value', snap => {
    const notifications = snap.val() || {};
    notificationList.innerHTML = '';
    let unreadCount = 0;
    
    Object.entries(notifications).reverse().forEach(([nid, n]) => {
      const emoji = getEmojiForCategory(n.category);
      const notificationItem = document.createElement('div');
      notificationItem.className = `notification-item ${n.read ? '' : 'unread'}`;
      notificationItem.innerHTML = `
        <div class="d-flex justify-content-between">
          <span class="notification-category category-${n.category}">
            ${emoji} ${n.category}
          </span>
          <span class="notification-time">${formatTime(n.timestamp)}</span>
        </div>
        <div class="notification-title">${n.title}</div>
        <div class="notification-message">${n.message}</div>
      `;
      notificationList.appendChild(notificationItem);
      
      if (!n.read) unreadCount++;
    });
    
    // Update badge count
    if (unreadCount > 0) {
      notificationCount.textContent = unreadCount > 9 ? '9+' : unreadCount;
      notificationCount.classList.remove('d-none');
    } else {
      notificationCount.classList.add('d-none');
    }
  });
}

function getEmojiForCategory(category) {
  switch(category) {
    case 'info': return 'ℹ️';
    case 'warning': return '⚠️';
    case 'success': return '✅';
    case 'danger': return '❌';
    case 'payment': return '💳';
    case 'tournament': return '🏆';
    default: return '🔔';
  }
}

function sendNotification(uid, title, message, category = 'info') {
  const notificationId = db.ref().child(`users/${uid}/notifications`).push().key;
  db.ref(`users/${uid}/notifications/${notificationId}`).set({
    title,
    message,
    category,
    read: false,
    timestamp: firebase.database.ServerValue.TIMESTAMP
  });
}

// Scroll to top button
btnScrollTop.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

window.addEventListener('scroll', () => {
  if (window.pageYOffset > 300) {
    btnScrollTop.style.display = 'flex';
  } else {
    btnScrollTop.style.display = 'none';
  }
});

// REGISTER / LOGIN
btnRegister.addEventListener('click', async () => {
  const name = nameIn.value.trim(), 
        email = emailIn.value.trim(), 
        pass = passIn.value, 
        role = roleSelect.value;
  
  if (!name || !email || !pass) return alert('সব তথ্য পূরণ করুন');
  if (pass.length < 6) return alert('পাসওয়ার্ড কমপক্ষে ৬ অক্ষরের হতে হবে');
  
  try {
    const cred = await auth.createUserWithEmailAndPassword(email, pass);
    await db.ref('users/' + cred.user.uid).set({
      name,
      email,
      role,
      wallet: 0,
      verified: false,
      ban: false,
      createdAt: firebase.database.ServerValue.TIMESTAMP
    });
    
    // Send welcome notification
    sendNotification(cred.user.uid, 
      'স্বাগতম!', 
      `আপনি সফলভাবে ${role} হিসেবে রেজিস্টার করেছেন। FreeFire Arena এ অংশগ্রহণের জন্য আপনাকে ধন্যবাদ!`,
      'success'
    );
    
    alert('রেজিস্ট্রেশন সফল!');
    authModal.style.display = 'none';
  } catch (err) {
    alert(err.message);
  }
});

btnLogin.addEventListener('click', async () => {
  const email = emailIn.value.trim(), pass = passIn.value;
  if (!email || !pass) return alert('সব তথ্য পূরণ করুন');
  
  try {
    await auth.signInWithEmailAndPassword(email, pass);
    authModal.style.display = 'none';
  } catch (err) {
    alert(err.message);
  }
});

btnLogoutDash.addEventListener('click', () => auth.signOut());
btnLogoutBanned.addEventListener('click', () => auth.signOut());

// AUTH STATE CHANGE
auth.onAuthStateChanged(user => {
  if (user) {
    // Check if user is banned
    db.ref('users/' + user.uid + '/ban').once('value').then(snap => {
      const isBanned = snap.val();
      
      if (isBanned) {
        bannedScreen.style.display = 'flex';
        dash.style.display = 'none';
        homeDash.style.display = 'none';
        mobileBottomNav.classList.add('d-none');
      } else {
        bannedScreen.style.display = 'none';
        authModal.style.display = 'none';
        dash.style.display = 'block';
        homeDash.style.display = 'none';
        btnLogoutDash.classList.remove('d-none');
        btnLoginShow.classList.add('d-none');
        notificationBell.classList.remove('d-none');
        mobileBottomNav.classList.remove('d-none');
        loadUserData(user.uid);
      }
    });
  } else {
    bannedScreen.style.display = 'none';
    dash.style.display = 'none';
    homeDash.style.display = 'block';
    btnLogoutDash.classList.add('d-none');
    btnLoginShow.classList.remove('d-none');
    notificationBell.classList.add('d-none');
    mobileBottomNav.classList.add('d-none');
    loadHomeTournaments();
  }
});

// LOAD USER DATA
function loadUserData(uid) {
  db.ref('users/' + uid).on('value', snap => {
    const u = snap.val(); 
    if (!u) return;
    
    welcome.innerHTML = `স্বাগতম, <strong>${u.name}</strong> <span class="badge bg-secondary">${u.role}</span>`; 
    uidSpan.innerText = uid; 
    walletSpan.innerText = u.wallet || 0;
    playerView.style.display = u.role === 'player' ? 'block' : 'none';
    organizerView.style.display = u.role === 'organizer' ? 'block' : 'none';
    
    // Load notifications
    loadNotifications(uid);
    
    // Load appropriate data based on role
    if (u.role === 'player') {
      loadPlayerTournaments(uid);
      loadTransactionHistory(uid);
    } else if (u.role === 'organizer') {
      loadOrganizerTournaments(uid);
    }
  });
}

// LOAD TRANSACTION HISTORY
function loadTransactionHistory(uid) {
  db.ref(`transactions/${uid}`).orderByChild('timestamp').limitToLast(20).on('value', snap => {
    const transactions = snap.val() || {};
    transactionHistory.innerHTML = '';
    
    if (Object.keys(transactions).length === 0) {
      transactionHistory.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-exchange-alt"></i>
          <p>No transactions yet</p>
        </div>
      `;
      return;
    }
    
    Object.entries(transactions).reverse().forEach(([tid, t]) => {
      const transactionItem = document.createElement('div');
      transactionItem.className = 'transaction-item';
      
      const emoji = t.type === 'deposit' ? '⬆️' : '⬇️';
      const amountClass = t.type === 'deposit' ? 'positive' : 'negative';
      
      transactionItem.innerHTML = `
        <div>
          <div class="transaction-details">${emoji} ${t.description || 'Transaction'}</div>
          <small class="text-muted">${formatTime(t.timestamp)}</small>
        </div>
        <div class="transaction-amount ${amountClass}">${t.type === 'deposit' ? '+' : '-'}${t.amount}৳</div>
      `;
      
      transactionHistory.appendChild(transactionItem);
    });
  });
}

// LOAD PLAYER TOURNAMENTS
function loadPlayerTournaments(uid) {
  db.ref('tournaments').orderByChild('status').equalTo('approved').on('value', snap => {
    const tournaments = snap.val() || {};
    tournamentsBody.innerHTML = '';
    
    if (Object.keys(tournaments).length === 0) {
      tournamentsBody.innerHTML = `
        <tr>
          <td colspan="4" class="text-center py-4">
            <i class="fas fa-trophy text-muted mb-2" style="font-size: 1.5rem;"></i>
            <p class="mb-0">No tournaments available</p>
          </td>
        </tr>
      `;
      return;
    }
    
    Object.entries(tournaments).forEach(([tid, t]) => {
      db.ref('users/' + t.organizer).once('value').then(uSnap => {
        const organizer = uSnap.val() || {};
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${t.name}</td>
          <td>${t.fee}৳</td>
          <td>${formatDate(t.date)} ${t.time}</td>
          <td>
            <button class="btn btn-sm btn-primary join-tournament" data-tid="${tid}" data-fee="${t.fee}">
              Join
            </button>
          </td>
        `;
        
        tournamentsBody.appendChild(tr);
        
        // Add join tournament event
        tr.querySelector('.join-tournament').addEventListener('click', async function() {
          const tournamentId = this.getAttribute('data-tid');
          const fee = parseInt(this.getAttribute('data-fee'));
          
          // Check wallet balance
          const userSnap = await db.ref('users/' + uid).once('value');
          const user = userSnap.val();
          
          if (user.wallet < fee) {
            alert('আপনার ওয়ালেটে পর্যাপ্ত টাকা নেই। প্রথমে ব্যালেন্স যোগ করুন।');
            return;
          }
          
          // Check if already joined
          const joinedSnap = await db.ref(`tournaments/${tournamentId}/players/${uid}`).once('value');
          if (joinedSnap.exists()) {
            alert('আপনি ইতিমধ্যে এই টুর্নামেন্টে যোগ দিয়েছেন!');
            return;
          }
          
          // Deduct fee and join tournament
          try {
            await db.ref(`tournaments/${tournamentId}/players/${uid}`).set(true);
            await db.ref(`users/${uid}/wallet`).transaction(current => (current || 0) - fee);
            await db.ref(`users/${t.organizer}/wallet`).transaction(current => (current || 0) + fee);
            
            // Record transaction
            const transactionId = db.ref().child(`transactions/${uid}`).push().key;
            await db.ref(`transactions/${uid}/${transactionId}`).set({
              type: 'withdraw',
              amount: fee,
              description: `Joined tournament: ${t.name}`,
              timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            // Send notification to organizer
            sendNotification(t.organizer, 
              'নতুন প্লেয়ার যোগ দিয়েছে', 
              `${user.name} আপনার "${t.name}" টুর্নামেন্টে যোগ দিয়েছে।`,
              'tournament'
            );
            
            // Send notification to player
            sendNotification(uid,
              'টুর্নামেন্টে যোগদান সফল',
              `আপনি সফলভাবে "${t.name}" টুর্নামেন্টে যোগ দিয়েছেন। টুর্নামেন্টের তারিখ: ${formatDate(t.date)} ${t.time}`,
              'success'
            );
            
            alert('টুর্নামেন্টে সফলভাবে যোগ দিয়েছেন!');
          } catch (err) {
            alert('ত্রুটি: ' + err.message);
          }
        });
      });
    });
  });
}

// LOAD ORGANIZER TOURNAMENTS
function loadOrganizerTournaments(uid) {
  db.ref('tournaments').orderByChild('organizer').equalTo(uid).on('value', snap => {
    const tournaments = snap.val() || {};
    organizerTournamentsBody.innerHTML = '';
    
    if (Object.keys(tournaments).length === 0) {
      organizerTournamentsBody.innerHTML = `
        <tr>
          <td colspan="4" class="text-center py-4">
            <i class="fas fa-trophy text-muted mb-2" style="font-size: 1.5rem;"></i>
            <p class="mb-0">No tournaments created yet</p>
          </td>
        </tr>
      `;
      return;
    }
    
    Object.entries(tournaments).forEach(([tid, t]) => {
      // Count players
      const playerCount = t.players ? Object.keys(t.players).length : 0;
      
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${t.name}</td>
        <td>
          <span class="badge ${getStatusBadgeClass(t.status)}">
            ${t.status}
          </span>
        </td>
        <td>${playerCount}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary view-tournament" data-tid="${tid}">
            View
          </button>
        </td>
      `;
      
      organizerTournamentsBody.appendChild(tr);
      
      // Add view tournament event
      tr.querySelector('.view-tournament').addEventListener('click', function() {
        const tournamentId = this.getAttribute('data-tid');
        viewTournamentDetails(tournamentId, tournaments[tournamentId]);
      });
    });
  });
}

function getStatusBadgeClass(status) {
  switch(status) {
    case 'approved': return 'bg-success';
    case 'pending': return 'bg-warning';
    case 'rejected': return 'bg-danger';
    default: return 'bg-secondary';
  }
}

function viewTournamentDetails(tid, tournament) {
  // Create a modal to show tournament details
  const modal = document.createElement('div');
  modal.className = 'modal fade';
  modal.id = 'tournamentModal';
  modal.innerHTML = `
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">${tournament.name}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ${tournament.image ? `<img src="${tournament.image}" class="img-fluid mb-3 rounded" alt="Tournament Image">` : ''}
          <div class="row mb-3">
            <div class="col-md-6">
              <p><strong>Entry Fee:</strong> ${tournament.fee}৳</p>
              <p><strong>Date:</strong> ${formatDate(tournament.date)}</p>
              <p><strong>Time:</strong> ${tournament.time}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(tournament.status)}">${tournament.status}</span></p>
              <p><strong>Players Joined:</strong> ${tournament.players ? Object.keys(tournament.players).length : 0}</p>
              <p><strong>Total Earnings:</strong> ${tournament.players ? Object.keys(tournament.players).length * tournament.fee : 0}৳</p>
            </div>
          </div>
          ${tournament.prize ? `<div class="mb-3"><strong>Prize:</strong><br>${tournament.prize}</div>` : ''}
          
          <h5 class="mt-4 mb-3">Joined Players</h5>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>UID</th>
                </tr>
              </thead>
              <tbody id="tournamentPlayersList">
                <!-- Players will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // Load Bootstrap modal
  const modalInstance = new bootstrap.Modal(document.getElementById('tournamentModal'));
  modalInstance.show();
  
  // Load players list
  const playersList = document.getElementById('tournamentPlayersList');
  if (tournament.players) {
    Object.keys(tournament.players).forEach(playerId => {
      db.ref(`users/${playerId}`).once('value').then(snap => {
        const player = snap.val();
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${player.name}</td>
          <td>${playerId}</td>
        `;
        playersList.appendChild(tr);
      });
    });
  }
  
  // Remove modal when closed
  document.getElementById('tournamentModal').addEventListener('hidden.bs.modal', function() {
    this.remove();
  });
}

// LOAD HOME TOURNAMENTS (Grid View)
function loadHomeTournaments() {
  tournamentsLoading.style.display = 'block';
  
  db.ref('tournaments').orderByChild('status').equalTo('approved').on('value', snap => {
    const tournaments = snap.val() || {};
    tournamentsGrid.innerHTML = '';
    tournamentsLoading.style.display = 'none';
    
    if (Object.keys(tournaments).length === 0) {
      tournamentsGrid.innerHTML = `
        <div class="col-12">
          <div class="empty-state">
            <i class="fas fa-trophy"></i>
            <h5>No tournaments available</h5>
            <p>Check back later for upcoming tournaments</p>
          </div>
        </div>
      `;
      return;
    }
    
    Object.entries(tournaments).forEach(([tid, t]) => {
      db.ref('users/' + t.organizer).once('value').then(uSnap => {
        const organizer = uSnap.val() || {};
        
        // Check if tournament is premium
        const isPremium = t.premium || false;
        
        const card = document.createElement('div');
        card.className = 'col-md-6 col-lg-4';
        card.innerHTML = `
          <div class="tournament-card ${isPremium ? 'premium pulse' : ''}">
            ${isPremium ? '<span class="premium-badge"><i class="fas fa-crown me-1"></i> Premium</span>' : ''}
            <div class="card-header d-flex justify-content-between align-items-center">
              <span>${t.name}</span>
              <span class="${isPremium ? 'premium-badge' : 'fee-badge'}">${t.fee}৳</span>
            </div>
            ${t.image ? `<img src="${t.image}" class="tournament-image" alt="${t.name}">` : ''}
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <div>
                  <i class="fas fa-user-tie me-2"></i>
                  <span>${organizer.name}</span>
                  ${organizer.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                </div>
              </div>
              <div class="date-time mb-3">
                <i class="far fa-calendar-alt me-2"></i>
                ${formatDate(t.date)} at ${t.time}
              </div>
              ${t.prize ? `<div class="mb-3"><strong>Prize:</strong> ${t.prize}</div>` : ''}
              <button class="btn btn-primary w-100 join-tournament-btn" data-tid="${tid}" data-fee="${t.fee}">
                ${auth.currentUser ? 'Join Tournament' : 'Login to Join'}
              </button>
            </div>
          </div>
        `;
        
        tournamentsGrid.appendChild(card);
        
        // Add join button event
        card.querySelector('.join-tournament-btn').addEventListener('click', function() {
          if (!auth.currentUser) {
            authModal.style.display = 'flex';
          } else {
            const tournamentId = this.getAttribute('data-tid');
            const fee = parseInt(this.getAttribute('data-fee'));
            
            // Check wallet balance
            db.ref('users/' + auth.currentUser.uid).once('value').then(snap => {
              const user = snap.val();
              
              if (user.wallet < fee) {
                alert('আপনার ওয়ালেটে পর্যাপ্ত টাকা নেই। প্রথমে ব্যালেন্স যোগ করুন।');
                return;
              }
              
              // Check if already joined
              db.ref(`tournaments/${tournamentId}/players/${auth.currentUser.uid}`).once('value').then(joinedSnap => {
                if (joinedSnap.exists()) {
                  alert('আপনি ইতিমধ্যে এই টুর্নামেন্টে যোগ দিয়েছেন!');
                  return;
                }
                
                // Deduct fee and join tournament
                db.ref(`tournaments/${tournamentId}/players/${auth.currentUser.uid}`).set(true)
                  .then(() => {
                    return db.ref(`users/${auth.currentUser.uid}/wallet`).transaction(current => (current || 0) - fee);
                  })
                  .then(() => {
                    return db.ref(`users/${t.organizer}/wallet`).transaction(current => (current || 0) + fee);
                  })
                  .then(() => {
                    // Record transaction
                    const transactionId = db.ref().child(`transactions/${auth.currentUser.uid}`).push().key;
                    return db.ref(`transactions/${auth.currentUser.uid}/${transactionId}`).set({
                      type: 'withdraw',
                      amount: fee,
                      description: `Joined tournament: ${t.name}`,
                      timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                  })
                  .then(() => {
                    // Send notification to organizer
                    sendNotification(t.organizer, 
                      'নতুন প্লেয়ার যোগ দিয়েছে', 
                      `${user.name} আপনার "${t.name}" টুর্নামেন্টে যোগ দিয়েছে।`,
                      'tournament'
                    );
                    
                    // Send notification to player
                    sendNotification(auth.currentUser.uid,
                      'টুর্নামেন্টে যোগদান সফল',
                      `আপনি সফলভাবে "${t.name}" টুর্নামেন্টে যোগ দিয়েছেন। টুর্নামেন্টের তারিখ: ${formatDate(t.date)} ${t.time}`,
                      'success'
                    );
                    
                    alert('টুর্নামেন্টে সফলভাবে যোগ দিয়েছেন!');
                  })
                  .catch(err => {
                    alert('ত্রুটি: ' + err.message);
                  });
              });
            });
          }
        });
      });
    });
    
    // Show only one premium tournament at the top
    const premiumTournaments = document.querySelectorAll('.tournament-card.premium');
    if (premiumTournaments.length > 0) {
      tournamentsGrid.insertBefore(premiumTournaments[0].parentNode, tournamentsGrid.firstChild);
    }
  });
}

// Format date to display nicely
function formatDate(dateString) {
  const options = { year: 'numeric', month: 'short', day: 'numeric' };
  return new Date(dateString).toLocaleDateString('en-US', options);
}

// Format time to display nicely
function formatTime(timestamp) {
  const options = { hour: '2-digit', minute: '2-digit', day: 'numeric', month: 'short' };
  return new Date(timestamp).toLocaleDateString('en-US', options);
}

// Initialize the page
document.addEventListener('DOMContentLoaded', () => {
  // Load initial data
  if (auth.currentUser) {
    loadUserData(auth.currentUser.uid);
  } else {
    loadHomeTournaments();
  }
  
  // Implement search functionality
  searchTournaments.addEventListener('input', () => {
    const searchTerm = searchTournaments.value.toLowerCase();
    const cards = document.querySelectorAll('.tournament-card');
    
    cards.forEach(card => {
      const name = card.querySelector('.card-header span').textContent.toLowerCase();
      if (name.includes(searchTerm)) {
        card.parentNode.style.display = 'block';
      } else {
        card.parentNode.style.display = 'none';
      }
    });
  });
  
  filterFee.addEventListener('change', () => {
    const feeRange = filterFee.value;
    filterTournaments(feeRange);
  });
  
  // Add balance functionality
  document.getElementById('btn-add-balance').addEventListener('click', async () => {
    const amount = parseInt(document.getElementById('add-amount').value);
    const number = document.getElementById('add-number').value;
    const method = document.querySelector('.payment-method.active').getAttribute('data-method');
    
    if (!amount || amount <= 0 || !number || number.length !== 11) {
      alert('সঠিক তথ্য প্রদান করুন');
      return;
    }
    
    const uid = auth.currentUser.uid;
    const requestId = db.ref().child('paymentRequests').push().key;
    
    try {
      await db.ref(`paymentRequests/${requestId}`).set({
        userId: uid,
        amount,
        number,
        method,
        status: 'pending',
        type: 'deposit',
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      
      // Send notification to user
      sendNotification(uid,
        'ব্যালেন্স রিকোয়েস্ট জমা হয়েছে',
        `আপনার ${amount}৳ ব্যালেন্স যোগের রিকোয়েস্ট জমা হয়েছে। এডমিন অ্যাপ্রুভ করলেই আপনার ওয়ালেটে টাকা যোগ হবে।`,
        'payment'
      );
      
      alert('আপনার রিকোয়েস্ট জমা হয়েছে। এডমিন অ্যাপ্রুভ করলেই আপনার ওয়ালেটে টাকা যোগ হবে।');
      document.getElementById('add-amount').value = '';
      document.getElementById('add-number').value = '';
    } catch (err) {
      alert('ত্রুটি: ' + err.message);
    }
  });
  
  // Withdraw functionality
  document.getElementById('btn-withdraw').addEventListener('click', async () => {
    const amount = parseInt(document.getElementById('withdraw-amount').value);
    const number = document.getElementById('withdraw-number').value;
    const method = document.getElementById('withdraw-method').value;
    
    if (!amount || amount <= 0 || !number || number.length !== 11) {
      alert('সঠিক তথ্য প্রদান করুন');
      return;
    }
    
    const uid = auth.currentUser.uid;
    
    // Check wallet balance
    const userSnap = await db.ref(`users/${uid}`).once('value');
    const user = userSnap.val();
    
    if (user.wallet < amount) {
      alert('আপনার ওয়ালেটে পর্যাপ্ত টাকা নেই।');
      return;
    }
    
    const requestId = db.ref().child('paymentRequests').push().key;
    
    try {
      await db.ref(`paymentRequests/${requestId}`).set({
        userId: uid,
        amount,
        number,
        method,
        status: 'pending',
        type: 'withdraw',
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      
      // Send notification to user
      sendNotification(uid,
        'উত্তোলনের রিকোয়েস্ট জমা হয়েছে',
        `আপনার ${amount}৳ উত্তোলনের রিকোয়েস্ট জমা হয়েছে। এডমিন অ্যাপ্রুভ করলেই টাকা পাঠানো হবে।`,
        'payment'
      );
      
      alert('আপনার উত্তোলনের রিকোয়েস্ট জমা হয়েছে। এডমিন অ্যাপ্রুভ করলেই টাকা পাঠানো হবে।');
      document.getElementById('withdraw-amount').value = '';
      document.getElementById('withdraw-number').value = '';
    } catch (err) {
      alert('ত্রুটি: ' + err.message);
    }
  });
  
  // Create tournament functionality
  document.getElementById('btn-create-t').addEventListener('click', async () => {
    const name = document.getElementById('t-name').value.trim();
    const fee = parseInt(document.getElementById('t-fee').value);
    const image = document.getElementById('t-image').value.trim();
    const date = document.getElementById('t-date').value;
    const time = document.getElementById('t-time').value;
    const prize = document.getElementById('t-prize').value.trim();
    const premium = document.getElementById('t-premium').checked;
    
    if (!name || !fee || fee < 0 || !date || !time) {
      alert('সব প্রয়োজনীয় তথ্য প্রদান করুন');
      return;
    }
    
    const uid = auth.currentUser.uid;
    const tournamentId = db.ref().child('tournaments').push().key;
    
    try {
      await db.ref(`tournaments/${tournamentId}`).set({
        name,
        fee,
        image,
        date,
        time,
        prize: prize || '',
        organizer: uid,
        premium,
        status: 'pending',
        createdAt: firebase.database.ServerValue.TIMESTAMP
      });
      
      // Send notification to organizer
      sendNotification(uid,
        'টুর্নামেন্ট তৈরি হয়েছে',
        `আপনার "${name}" টুর্নামেন্ট তৈরি হয়েছে। এডমিন অ্যাপ্রুভ করলেই এটি পাবলিশ হবে।`,
        'tournament'
      );
      
      alert('আপনার টুর্নামেন্ট তৈরি হয়েছে! এডমিন অ্যাপ্রুভ করলেই এটি পাবলিশ হবে।');
      document.getElementById('t-name').value = '';
      document.getElementById('t-fee').value = '';
      document.getElementById('t-image').value = '';
      document.getElementById('t-date').value = '';
      document.getElementById('t-time').value = '';
      document.getElementById('t-prize').value = '';
      document.getElementById('t-premium').checked = false;
    } catch (err) {
      alert('ত্রুটি: ' + err.message);
    }
  });
});

// Initialize Bootstrap tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl)
});
</script>
</body>
</html>
