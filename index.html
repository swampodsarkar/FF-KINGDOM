<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FF Kingdom - Mobile App</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #facc15;
  --dark: #0f172a;
  --dark-light: #1e293b;
  --text: #f8fafc;
  --text-secondary: #cbd5e1;
  --success: #22c55e;
  --danger: #ef4444;
  --info: #3b82f6;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--dark);
  color: var(--text);
  padding-bottom: 60px;
}

.header {
  background: var(--dark-light);
  color: var(--primary);
  padding: 15px;
  text-align: center;
  font-weight: 700;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 100;
}

.container {
  padding: 16px;
}

.card {
  background: var(--dark-light);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  border: none;
}

.input-group {
  margin-bottom: 12px;
}

.input-group label {
  display: block;
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 5px;
}

.input-group input, .input-group select, .input-group textarea {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #334155;
  background: var(--dark);
  color: var(--text);
  font-family: 'Poppins', sans-serif;
}

.btn {
  background: var(--primary);
  color: var(--dark);
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn i {
  margin-right: 5px;
}

.btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}

.btn-sm {
  padding: 6px 12px;
  font-size: 14px;
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-info {
  background: var(--info);
  color: white;
}

.hidden {
  display: none;
}

.nav-bottom {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  background: var(--dark-light);
  padding: 10px 0;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  z-index: 100;
}

.nav-btn {
  flex: 1;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 0;
}

.nav-btn i {
  font-size: 18px;
  margin-bottom: 4px;
}

.nav-btn.active {
  color: var(--primary);
}

.countdown {
  color: var(--primary);
  font-weight: 700;
}

.tournament-card {
  transition: transform 0.3s;
  margin-bottom: 20px;
  overflow: hidden;
}

.tournament-card:hover {
  transform: translateY(-5px);
}

.tournament-img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 8px;
}

.tournament-content {
  padding: 12px;
}

.tournament-title {
  color: var(--primary);
  margin: 4px 0;
  font-size: 18px;
  font-weight: 600;
}

.tournament-info {
  font-size: 14px;
  color: var(--text-secondary);
  margin: 2px 0;
  display: flex;
  align-items: center;
  gap: 5px;
}

.tournament-actions {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.tournament-actions button {
  flex: 1;
}

.profile-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.profile-pic {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--primary);
}

.profile-info {
  margin-left: 15px;
}

.profile-name {
  font-size: 20px;
  font-weight: 600;
  margin: 0;
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin: 15px 0;
}

.stat-card {
  background: var(--dark);
  padding: 12px;
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--primary);
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary);
}

.emoji-picker {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin: 10px 0;
  max-height: 100px;
  overflow-y: auto;
  padding: 5px;
  background: var(--dark);
  border-radius: 8px;
}

.emoji-option {
  font-size: 24px;
  cursor: pointer;
  padding: 5px;
  border-radius: 5px;
  transition: background 0.2s;
}

.emoji-option:hover {
  background: rgba(255, 255, 255, 0.1);
}

.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background: var(--dark-light);
  padding: 20px;
  border-radius: 12px;
  max-width: 90%;
  max-height: 80%;
  overflow-y: auto;
  color: var(--text);
  width: 400px;
}

.modal-title {
  color: var(--primary);
  margin-top: 0;
  margin-bottom: 15px;
}

.form-section {
  margin-bottom: 20px;
}

.form-section-title {
  color: var(--primary);
  font-size: 16px;
  margin-bottom: 10px;
  padding-bottom: 5px;
  border-bottom: 1px solid #334155;
}

.tournament-details {
  line-height: 1.6;
}

.tournament-details strong {
  color: var(--primary);
}

.loading {
  text-align: center;
  padding: 20px;
  color: var(--text-secondary);
}

.wallet-section {
  margin: 15px 0;
}

.transaction-list {
  max-height: 200px;
  overflow-y: auto;
}

.transaction-item {
  padding: 10px;
  border-bottom: 1px solid #334155;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.transaction-item:last-child {
  border-bottom: none;
}

.status-pending {
  color: #f59e0b;
}

.status-approved {
  color: var(--success);
}

.status-rejected {
  color: var(--danger);
}

.registration-tabs {
  display: flex;
  margin-bottom: 15px;
  border-bottom: 1px solid #334155;
}

.tab-btn {
  padding: 10px 15px;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-weight: 500;
  cursor: pointer;
}

.tab-btn.active {
  color: var(--primary);
  border-bottom: 2px solid var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.text-small {
  font-size: 12px;
  color: var(--text-secondary);
}

.currency-badge {
  background: var(--primary);
  color: var(--dark);
  padding: 2px 8px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 12px;
}

.player-name {
  color: var(--primary);
  font-weight: 500;
}

.player-list {
  max-height: 200px;
  overflow-y: auto;
  margin-top: 10px;
}

.player-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid #334155;
}

.player-item:last-child {
  border-bottom: none;
}

.player-uid {
  font-size: 12px;
  color: var(--text-secondary);
}

.uploading {
  opacity: 0.7;
  pointer-events: none;
}

.progress-bar {
  height: 5px;
  background: #334155;
  border-radius: 10px;
  margin-top: 5px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--primary);
  width: 0%;
  transition: width 0.3s;
}
</style>
</head>
<body>

<!-- Login/Registration Page -->
<div id="authPage" class="container">
  <div class="card">
    <h2 class="text-center mb-4">👑 FF Kingdom</h2>
    
    <div class="registration-tabs">
      <button class="tab-btn active" id="loginTabBtn">Login</button>
      <button class="tab-btn" id="registerTabBtn">Register</button>
    </div>
    
    <div class="tab-content active" id="loginTab">
      <div class="input-group">
        <label for="loginEmail">📧 Email</label>
        <input id="loginEmail" type="email" placeholder="Your email"/>
      </div>
      <div class="input-group">
        <label for="loginPassword">🔒 Password</label>
        <input id="loginPassword" type="password" placeholder="Password"/>
      </div>
      <button id="loginBtn" class="btn w-100"><i class="fas fa-sign-in-alt"></i> Login</button>
    </div>
    
    <div class="tab-content" id="registerTab">
      <div class="input-group">
        <label for="regName">👤 Full Name</label>
        <input id="regName" type="text" placeholder="Your full name"/>
      </div>
      <div class="input-group">
        <label for="regEmail">📧 Email</label>
        <input id="regEmail" type="email" placeholder="Your email"/>
      </div>
      <div class="input-group">
        <label for="regMobile">📱 Mobile Number</label>
        <input id="regMobile" type="tel" placeholder="Your mobile number"/>
      </div>
      <div class="input-group">
        <label for="regFFUID">🎮 Free Fire UID</label>
        <input id="regFFUID" type="text" placeholder="Your Free Fire UID"/>
      </div>
      <div class="input-group">
        <label for="regPassword">🔒 Password</label>
        <input id="regPassword" type="password" placeholder="Create password"/>
      </div>
      <div class="input-group">
        <label for="regConfirmPassword">🔒 Confirm Password</label>
        <input id="regConfirmPassword" type="password" placeholder="Confirm your password"/>
      </div>
      <button id="signUpBtn" class="btn w-100"><i class="fas fa-user-plus"></i> Create Account</button>
    </div>
  </div>
</div>

<!-- Main App Pages -->
<div id="appPages" class="hidden">
  <div class="header">
    <h1>🔥 FF Kingdom</h1>
  </div>

  <div id="homePage" class="container">
    <h3 class="mb-3">🔥 Ongoing Tournaments</h3>
    <div id="tournamentsList" class="loading">
      <i class="fas fa-spinner fa-spin"></i> Loading tournaments...
    </div>
  </div>

  <div id="profilePage" class="container hidden">
    <div class="card">
      <div class="profile-header">
        <img id="profilePic" src="https://via.placeholder.com/80" class="profile-pic" alt="Profile"/>
        <div class="profile-info">
          <h2 class="profile-name" id="profileName">Player Name</h2>
          <p id="profileFFUID">🎮 Free Fire UID: <span>Not set</span></p>
          <p id="profileStatusDisplay" class="text-small">💬 Status: No status set</p>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value" id="walletBalance">0</div>
          <div class="stat-label">💰 BDT</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="profileMatches">0</div>
          <div class="stat-label">🎮 Matches</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="profileWins">0</div>
          <div class="stat-label">🏆 Wins</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="profileIncome">0</div>
          <div class="stat-label">💵 Income</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="form-section-title"><i class="fas fa-user-edit"></i> Edit Profile</h3>
      
      <div class="input-group">
        <label for="editName">👤 Display Name</label>
        <input id="editName" type="text" placeholder="Your display name"/>
      </div>
      
      <div class="input-group">
        <label for="editFFUID">🎮 Free Fire UID</label>
        <input id="editFFUID" type="text" placeholder="Your Free Fire UID"/>
      </div>
      
      <div class="input-group">
        <label for="profileStatus">💬 Status</label>
        <textarea id="profileStatus" placeholder="What's on your mind?" rows="2"></textarea>
      </div>
      
      <div class="input-group">
        <label>😊 Select Emoji for Profile</label>
        <div class="emoji-picker">
          <span class="emoji-option">😊</span>
          <span class="emoji-option">😎</span>
          <span class="emoji-option">🥳</span>
          <span class="emoji-option">🎮</span>
          <span class="emoji-option">🔥</span>
          <span class="emoji-option">👑</span>
          <span class="emoji-option">💪</span>
          <span class="emoji-option">⚡</span>
          <span class="emoji-option">⭐</span>
          <span class="emoji-option">🎯</span>
        </div>
      </div>
      
      <div class="input-group">
        <label for="profilePicFile">🖼️ Profile Picture</label>
        <input id="profilePicFile" type="file" accept="image/*"/>
        <div class="progress-bar">
          <div class="progress-fill" id="uploadProgress"></div>
        </div>
      </div>
      
      <button id="updateProfileBtn" class="btn w-100"><i class="fas fa-save"></i> Update Profile</button>
      <button id="uploadPicBtn" class="btn btn-info w-100 mt-2"><i class="fas fa-upload"></i> Upload Picture</button>
    </div>

    <div class="card">
      <h3 class="form-section-title"><i class="fas fa-wallet"></i> Wallet</h3>
      
      <div class="wallet-section">
        <h4><i class="fas fa-money-bill-wave"></i> Deposit (min 10)</h4>
        <p>Send <b>01767882562</b> এবং নিচে Transaction ID দিন</p>
        
        <div class="input-group">
          <label for="depositAmount">💰 Amount</label>
          <input id="depositAmount" type="number" placeholder="Amount" min="10"/>
        </div>
        
        <div class="input-group">
          <label for="depositTransactionId">📋 Transaction ID</label>
          <input id="depositTransactionId" type="text" placeholder="Transaction ID"/>
        </div>
        
        <div class="input-group">
          <label for="depositMethod">💳 Payment Method</label>
          <select id="depositMethod">
            <option>📱 bKash</option>
            <option>📱 Nagad</option>
            <option>📱 Rocket</option>
          </select>
        </div>
        
        <button id="depositBtn" class="btn w-100"><i class="fas fa-plus-circle"></i> Deposit</button>
      </div>
      
      <div class="wallet-section">
        <h4><i class="fas fa-hand-holding-usd"></i> Withdraw (min 100)</h4>
        
        <div class="input-group">
          <label for="withdrawAmount">💰 Amount</label>
          <input id="withdrawAmount" type="number" placeholder="Amount" min="100"/>
        </div>
        
        <div class="input-group">
          <label for="withdrawAccount">📋 Account Number</label>
          <input id="withdrawAccount" type="text" placeholder="Account Number"/>
        </div>
        
        <div class="input-group">
          <label for="withdrawMethod">💳 Payment Method</label>
          <select id="withdrawMethod">
            <option>📱 bKash</option>
            <option>📱 Nagad</option>
            <option>📱 Rocket</option>
          </select>
        </div>
        
        <button id="withdrawBtn" class="btn w-100"><i class="fas fa-download"></i> Withdraw</button>
      </div>
    </div>

    <div class="card">
      <h3 class="form-section-title"><i class="fas fa-history"></i> Transaction History</h3>
      <div id="transactionsList" class="transaction-list">
        <div class="text-center py-3">No records found</div>
      </div>
    </div>
  </div>

  <div id="myTournamentsPage" class="container hidden">
    <h3 class="mb-3"><i class="fas fa-trophy"></i> My Tournaments</h3>
    <div class="card">
      <div id="myTournamentsList" class="loading">
        <i class="fas fa-spinner fa-spin"></i> Loading your tournaments...
      </div>
    </div>
  </div>

  <div id="morePage" class="container hidden">
    <h3 class="mb-3"><i class="fas fa-cog"></i> More Options</h3>
    
    <div class="card">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 class="mb-1"><i class="fas fa-download"></i> App Update</h4>
          <p class="mb-0 text-small">Latest version running</p>
        </div>
        <button id="updateBtn" class="btn btn-sm"><i class="fas fa-download"></i> Download</button>
      </div>
      
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 class="mb-1"><i class="fas fa-shield-alt"></i> Refund Policy</h4>
          <p class="mb-0 text-small">View our refund policy</p>
        </div>
        <button id="refundBtn" class="btn btn-sm btn-info"><i class="fas fa-eye"></i> View</button>
      </div>
      
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h4 class="mb-1"><i class="fas fa-gift"></i> Refer & Earn</h4>
          <p class="mb-0 text-small">Earn coins by referring friends</p>
        </div>
        <button id="referBtn" class="btn btn-sm btn-success"><i class="fas fa-tag"></i> View Code</button>
      </div>
    </div>
    
    <div class="card">
      <h4 class="form-section-title"><i class="fas fa-headset"></i> Support</h4>
      <p>Having issues? Contact our support team:</p>
      <p><i class="fas fa-envelope"></i> Email: support@ffkingdom.com</p>
      <p><i class="fab fa-facebook"></i> Facebook: /ffkingdom</p>
      <p><i class="fab fa-whatsapp"></i> WhatsApp: +8801767882562</p>
    </div>
    
    <button id="logoutBtn" class="btn btn-danger w-100"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>

  <div class="nav-bottom">
    <button class="nav-btn active" id="navHome">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </button>
    <button class="nav-btn" id="navProfile">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </button>
    <button class="nav-btn" id="navMyTournaments">
      <i class="fas fa-trophy"></i>
      <span>My Tournaments</span>
    </button>
    <button class="nav-btn" id="navMore">
      <i class="fas fa-ellipsis-h"></i>
      <span>More</span>
    </button>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBg">
  <div class="modal-content" id="modalContent">
    <h3 class="modal-title" id="modalTitle"></h3>
    <div id="modalBody"></div>
    <button class="btn w-100 mt-3" id="modalClose">Close</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD1-qeqgWg9-3TW--XnpWQHNTP7-ROhDIs",
  authDomain: "football-manager-cf301.firebaseapp.com",
  databaseURL: "https://football-manager-cf301-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "football-manager-cf301",
  storageBucket: "football-manager-cf301.firebasestorage.app",
  messagingSenderId: "491848692016",
  appId: "1:491848692016:web:dc080692f1c5ee6c5298f5",
  measurementId: "G-FQL2QPVX6P"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const MIN_DEPOSIT = 10, MIN_WITHDRAW = 100;
const IMGBB_API_KEY = 'a5e9f23952de30236c940c60b740ec9d';

// Navigation
const pages = {
  homePage: document.getElementById('homePage'),
  profilePage: document.getElementById('profilePage'),
  myTournamentsPage: document.getElementById('myTournamentsPage'),
  morePage: document.getElementById('morePage')
};

function showPage(pageId) {
  // Hide all pages
  for (let key in pages) {
    pages[key].classList.add('hidden');
  }
  
  // Show the selected page
  pages[pageId].classList.remove('hidden');
  
  // Update active nav button
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  document.getElementById('nav' + pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('Page', '')).classList.add('active');
}

// Set up navigation
document.getElementById('navHome').addEventListener('click', () => showPage('homePage'));
document.getElementById('navProfile').addEventListener('click', () => showPage('profilePage'));
document.getElementById('navMyTournaments').addEventListener('click', () => showPage('myTournamentsPage'));
document.getElementById('navMore').addEventListener('click', () => showPage('morePage'));

// Registration tabs
document.getElementById('loginTabBtn').addEventListener('click', function() {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  this.classList.add('active');
  document.getElementById('loginTab').classList.add('active');
});

document.getElementById('registerTabBtn').addEventListener('click', function() {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  this.classList.add('active');
  document.getElementById('registerTab').classList.add('active');
});

// Modal
const modalBg = document.getElementById('modalBg');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
document.getElementById('modalClose').addEventListener('click', () => {
  modalBg.style.display = 'none';
});

function showModal(title, body, isHTML = false) {
  modalTitle.innerText = title;
  if (isHTML) {
    modalBody.innerHTML = body;
  } else {
    modalBody.innerText = body;
  }
  modalBg.style.display = 'flex';
}

// More page buttons
document.getElementById('updateBtn').addEventListener('click', () => {
  window.open('https://yourappdownloadlink.com', '_blank');
});

document.getElementById('refundBtn').addEventListener('click', () => {
  showModal('Refund Policy', 'Refunds are only provided if a tournament is canceled by the organizers. In case of any issues, please contact our support team.');
});

document.getElementById('referBtn').addEventListener('click', () => {
  showModal('Refer & Earn', 'Your referral code: FFK12345. Share this code with your friends to earn 50 coins when they sign up and make their first deposit!');
});

// Load tournaments
function loadTournaments() {
  db.ref('tournaments').on('value', snap => {
    let html = "";
    if (snap.exists()) {
      snap.forEach(child => {
        let tournament = child.val();
        let image = tournament.image || 'https://via.placeholder.com/400x200?text=Tournament';
        let endTime = new Date(tournament.endTime || Date.now() + 3600000).getTime();
        
        html += `
          <div class="card tournament-card">
            <img src="${image}" class="tournament-img"/>
            <div class="tournament-content">
              <h3 class="tournament-title">${tournament.title || 'Unnamed Tournament'}</h3>
              <p class="tournament-info"><i class="fas fa-flag"></i> Type: ${tournament.type || 'Solo'}</p>
              <p class="tournament-info"><i class="fas fa-ticket-alt"></i> Entry: ${tournament.entryFee || 0} BDT</p>
              <p class="tournament-info"><i class="fas fa-award"></i> Prize: ${tournament.prizePool || 0} BDT</p>
              <p class="tournament-info"><i class="fas fa-users"></i> Players: ${tournament.players ? Object.keys(tournament.players).length : 0}/${tournament.maxPlayers || 50}</p>
              <p class="tournament-info"><i class="fas fa-clock"></i> Ends in: <span class="countdown" id="cd${child.key}">Loading...</span></p>
              <div class="tournament-actions">
                <button class="btn btn-sm btn-info" onclick="showTournamentDetails('${child.key}')"><i class="fas fa-info-circle"></i> Details</button>
                <button class="btn btn-sm btn-success" onclick="joinTournament('${child.key}', ${tournament.entryFee || 0})"><i class="fas fa-sign-in-alt"></i> Join</button>
              </div>
            </div>
          </div>
        `;
        
        setCountdown('cd' + child.key, endTime);
      });
    } else {
      html = '<div class="text-center py-4"><i class="fas fa-trophy fa-2x mb-3"></i><p>No tournaments available at the moment</p></div>';
    }
    
    document.getElementById('tournamentsList').innerHTML = html;
  });
}

// Countdown timer
function setCountdown(elementId, endTime) {
  const countdownElement = document.getElementById(elementId);
  if (!countdownElement) return;
  
  const timer = setInterval(() => {
    const now = new Date().getTime();
    const distance = endTime - now;
    
    if (distance < 0) {
      countdownElement.innerText = 'Ended';
      clearInterval(timer);
      return;
    }
    
    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
    countdownElement.innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
  }, 1000);
}

// Tournament details
function showTournamentDetails(tournamentId) {
  db.ref('tournaments/' + tournamentId).once('value').then(snapshot => {
    const tournament = snapshot.val();
    if (!tournament) {
      showModal('Error', 'Tournament not found');
      return;
    }
    
    const players = tournament.players ? Object.keys(tournament.players) : [];
    let detailsHTML = `
      <div class="tournament-details">
        <p><strong>Title:</strong> ${tournament.title || 'Unnamed Tournament'}</p>
        <p><strong>Type:</strong> ${tournament.type || 'Solo'}</p>
        <p><strong>Entry Fee:</strong> ${tournament.entryFee || 0} BDT</p>
        <p><strong>Prize Pool:</strong> ${tournament.prizePool || 0} BDT</p>
        <p><strong>Max Players:</strong> ${tournament.maxPlayers || 50}</p>
        <p><strong>Rules:</strong> ${tournament.rules || 'No special rules'}</p>
        <p><strong>Players Joined:</strong> ${players.length}</p>
        <hr>
        <p><strong>Player List:</strong></p>
        <div class="player-list">
    `;
    
    if (players.length > 0) {
      // Get player names instead of IDs
      const playerPromises = players.map(playerId => {
        return db.ref('users/' + playerId).once('value')
          .then(userSnapshot => {
            const user = userSnapshot.val() || {};
            return {
              name: user.name || 'Unknown Player',
              uid: user.freeFireUID || 'N/A'
            };
          });
      });
      
      Promise.all(playerPromises).then(players => {
        players.forEach((player, index) => {
          detailsHTML += `
            <div class="player-item">
              <div>
                <div class="player-name">${index + 1}. ${player.name}</div>
                <div class="player-uid">UID: ${player.uid}</div>
              </div>
              <span class="currency-badge">Joined</span>
            </div>
          `;
        });
        
        detailsHTML += `</div></div>`;
        showModal('Tournament Details', detailsHTML, true);
      });
    } else {
      detailsHTML += `<div class="text-center py-3">No players joined yet</div></div></div>`;
      showModal('Tournament Details', detailsHTML, true);
    }
  });
}

// Join tournament
function joinTournament(tournamentId, entryFee) {
  const user = auth.currentUser;
  if (!user) {
    showModal('Error', 'You must be logged in to join a tournament');
    return;
  }
  
  db.ref('users/' + user.uid + '/coins').once('value').then(snapshot => {
    const coins = snapshot.val() || 0;
    
    if (coins >= entryFee) {
      // Deduct entry fee
      db.ref('users/' + user.uid + '/coins').set(coins - entryFee);
      
      // Add user to tournament
      db.ref('tournaments/' + tournamentId + '/players/' + user.uid).set(true);
      
      // Add tournament to user's list
      db.ref('userTournaments/' + user.uid + '/' + tournamentId).set({
        joinedAt: Date.now(),
        status: 'registered',
        tournamentName: document.getElementById('tournamentsList').querySelector(`[onclick*="${tournamentId}"]`).closest('.tournament-card').querySelector('.tournament-title').textContent
      });
      
      showModal('Success', 'You have successfully joined the tournament!');
    } else {
      showModal('Error', 'You do not have enough coins to join this tournament');
    }
  });
}

// Load user profile
function loadProfile(userId) {
  db.ref('users/' + userId).on('value', snapshot => {
    const user = snapshot.val() || {};
    
    // Update profile page
    document.getElementById('profileName').textContent = user.name || 'Player';
    document.getElementById('walletBalance').textContent = user.coins || 0;
    document.getElementById('profileMatches').textContent = user.matchesPlayed || 0;
    document.getElementById('profileWins').textContent = user.wins || 0;
    document.getElementById('profileIncome').textContent = user.income || 0;
    
    if (user.freeFireUID) {
      document.querySelector('#profileFFUID span').textContent = user.freeFireUID;
    }
    
    if (user.profilePic) {
      document.getElementById('profilePic').src = user.profilePic;
    }
    
    if (user.status) {
      document.getElementById('profileStatusDisplay').textContent = '💬 Status: ' + user.status;
    }
    
    // Pre-fill edit form
    document.getElementById('editName').value = user.name || '';
    document.getElementById('editFFUID').value = user.freeFireUID || '';
    document.getElementById('profileStatus').value = user.status || '';
  });
}

// Load transactions
function loadTransactions(userId) {
  db.ref('transactions/' + userId).on('value', snapshot => {
    let transactionsHTML = '';
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const transaction = child.val();
        transactionsHTML += `
          <div class="transaction-item">
            <div>
              <div>${transaction.type} - ${transaction.amount} BDT</div>
              <small>${new Date(transaction.timestamp).toLocaleDateString()}</small>
            </div>
            <span class="status-${transaction.status}">${transaction.status}</span>
          </div>
        `;
      });
    } else {
      transactionsHTML = '<div class="text-center py-3">No transactions found</div>';
    }
    
    document.getElementById('transactionsList').innerHTML = transactionsHTML;
  });
}

// Load user's tournaments
function loadMyTournaments(userId) {
  db.ref('userTournaments/' + userId).on('value', snapshot => {
    let tournamentsHTML = '';
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const tournamentId = child.key;
        const tournamentData = child.val();
        
        // Get tournament details
        db.ref('tournaments/' + tournamentId).once('value').then(tournamentSnapshot => {
          const tournament = tournamentSnapshot.val();
          
          if (tournament) {
            tournamentsHTML += `
              <div class="card tournament-card">
                <div class="tournament-content">
                  <h3 class="tournament-title">${tournament.title || 'Unnamed Tournament'}</h3>
                  <p class="tournament-info"><i class="fas fa-flag"></i> Type: ${tournament.type || 'Solo'}</p>
                  <p class="tournament-info"><i class="fas fa-ticket-alt"></i> Entry: ${tournament.entryFee || 0} BDT</p>
                  <p class="tournament-info"><i class="fas fa-award"></i> Prize: ${tournament.prizePool || 0} BDT</p>
                  <p class="tournament-info"><i class="fas fa-users"></i> Players: ${tournament.players ? Object.keys(tournament.players).length : 0}/${tournament.maxPlayers || 50}</p>
                  <p class="tournament-info"><i class="fas fa-info-circle"></i> Status: ${tournamentData.status || 'registered'}</p>
                </div>
              </div>
            `;
            
            document.getElementById('myTournamentsList').innerHTML = tournamentsHTML;
          }
        });
      });
    } else {
      tournamentsHTML = '<div class="text-center py-4"><i class="fas fa-trophy fa-2x mb-3"></i><p>You haven\'t joined any tournaments yet</p></div>';
      document.getElementById('myTournamentsList').innerHTML = tournamentsHTML;
    }
  });
}

// Update profile
document.getElementById('updateProfileBtn').addEventListener('click', () => {
  const user = auth.currentUser;
  if (!user) return;
  
  const name = document.getElementById('editName').value;
  const freeFireUID = document.getElementById('editFFUID').value;
  const status = document.getElementById('profileStatus').value;
  
  const updates = {};
  if (name) updates.name = name;
  if (freeFireUID) updates.freeFireUID = freeFireUID;
  if (status) updates.status = status;
  
  db.ref('users/' + user.uid).update(updates)
    .then(() => {
      showModal('Success', 'Profile updated successfully');
      document.getElementById('profileStatusDisplay').textContent = '💬 Status: ' + status;
    })
    .catch(error => showModal('Error', error.message));
});

// Emoji selection
document.querySelectorAll('.emoji-option').forEach(emoji => {
  emoji.addEventListener('click', () => {
    document.getElementById('profileStatus').value += emoji.textContent;
  });
});

// Upload profile picture to ImgBB
document.getElementById('uploadPicBtn').addEventListener('click', () => {
  const fileInput = document.getElementById('profilePicFile');
  const file = fileInput.files[0];
  
  if (!file) {
    showModal('Error', 'Please select an image file');
    return;
  }
  
  const user = auth.currentUser;
  if (!user) return;
  
  // Show uploading state
  const uploadBtn = document.getElementById('uploadPicBtn');
  const originalText = uploadBtn.innerHTML;
  uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
  uploadBtn.classList.add('uploading');
  
  // Create form data
  const formData = new FormData();
  formData.append('image', file);
  formData.append('key', IMGBB_API_KEY);
  
  // Upload to ImgBB
  fetch('https://api.imgbb.com/1/upload', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Save the image URL to user profile
      return db.ref('users/' + user.uid).update({
        profilePic: data.data.url
      });
    } else {
      throw new Error('Image upload failed');
    }
  })
  .then(() => {
    showModal('Success', 'Profile picture updated successfully');
    document.getElementById('profilePic').src = URL.createObjectURL(file);
    uploadBtn.innerHTML = originalText;
    uploadBtn.classList.remove('uploading');
  })
  .catch(error => {
    showModal('Error', error.message);
    uploadBtn.innerHTML = originalText;
    uploadBtn.classList.remove('uploading');
  });
});

// Deposit
document.getElementById('depositBtn').addEventListener('click', () => {
  const amount = parseInt(document.getElementById('depositAmount').value);
  const transactionId = document.getElementById('depositTransactionId').value.trim();
  const method = document.getElementById('depositMethod').value;
  
  if (amount < MIN_DEPOSIT) {
    showModal('Error', `Minimum deposit is ${MIN_DEPOSIT} BDT`);
    return;
  }
  
  if (!transactionId) {
    showModal('Error', 'Please enter a transaction ID');
    return;
  }
  
  const user = auth.currentUser;
  if (!user) return;
  
  // Save deposit request
  db.ref('paymentRequests').push({
    userId: user.uid,
    amount: amount,
    method: method,
    transactionId: transactionId,
    type: 'deposit',
    status: 'pending',
    timestamp: Date.now()
  })
  .then(() => {
    showModal('Success', 'Deposit request submitted. It will be processed within 24 hours.');
    document.getElementById('depositAmount').value = '';
    document.getElementById('depositTransactionId').value = '';
  })
  .catch(error => showModal('Error', error.message));
});

// Withdraw
document.getElementById('withdrawBtn').addEventListener('click', () => {
  const amount = parseInt(document.getElementById('withdrawAmount').value);
  const account = document.getElementById('withdrawAccount').value.trim();
  const method = document.getElementById('withdrawMethod').value;
  
  if (amount < MIN_WITHDRAW) {
    showModal('Error', `Minimum withdrawal is ${MIN_WITHDRAW} BDT`);
    return;
  }
  
  if (!account) {
    showModal('Error', 'Please enter your account number');
    return;
  }
  
  const user = auth.currentUser;
  if (!user) return;
  
  // Check if user has enough balance
  db.ref('users/' + user.uid + '/coins').once('value').then(snapshot => {
    const coins = snapshot.val() || 0;
    
    if (coins < amount) {
      showModal('Error', 'You do not have enough coins to withdraw');
      return;
    }
    
    // Save withdrawal request
    db.ref('paymentRequests').push({
      userId: user.uid,
      amount: amount,
      method: method,
      account: account,
      type: 'withdraw',
      status: 'pending',
      timestamp: Date.now()
    })
    .then(() => {
      showModal('Success', 'Withdrawal request submitted. It will be processed within 24 hours.');
      document.getElementById('withdrawAmount').value = '';
      document.getElementById('withdrawAccount').value = '';
    })
    .catch(error => showModal('Error', error.message));
  });
});

// Authentication
document.getElementById('signUpBtn').addEventListener('click', () => {
  const name = document.getElementById('regName').value;
  const email = document.getElementById('regEmail').value;
  const mobile = document.getElementById('regMobile').value;
  const freeFireUID = document.getElementById('regFFUID').value;
  const password = document.getElementById('regPassword').value;
  const confirmPassword = document.getElementById('regConfirmPassword').value;
  
  if (!name || !email || !mobile || !freeFireUID || !password || !confirmPassword) {
    showModal('Error', 'Please fill all fields');
    return;
  }
  
  if (password !== confirmPassword) {
    showModal('Error', 'Passwords do not match');
    return;
  }
  
  auth.createUserWithEmailAndPassword(email, password)
    .then(userCredential => {
      const user = userCredential.user;
      
      // Save user data
      return db.ref('users/' + user.uid).set({
        name: name,
        email: email,
        mobile: mobile,
        freeFireUID: freeFireUID,
        coins: 0,
        matchesPlayed: 0,
        wins: 0,
        income: 0,
        joinedAt: Date.now()
      });
    })
    .then(() => {
      showModal('Success', 'Account created successfully!');
      // Switch to login tab
      document.getElementById('loginTabBtn').click();
    })
    .catch(error => {
      showModal('Error', error.message);
    });
});

document.getElementById('loginBtn').addEventListener('click', () => {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  
  if (!email || !password) {
    showModal('Error', 'Please enter email and password');
    return;
  }
  
  auth.signInWithEmailAndPassword(email, password)
    .then(userCredential => {
      const user = userCredential.user;
      
      // Hide auth page, show app
      document.getElementById('authPage').classList.add('hidden');
      document.getElementById('appPages').classList.remove('hidden');
      
      // Load user data
      loadProfile(user.uid);
      loadTournaments();
      loadTransactions(user.uid);
      loadMyTournaments(user.uid);
    })
    .catch(error => {
      showModal('Error', error.message);
    });
});

// Logout
document.getElementById('logoutBtn').addEventListener('click', () => {
  auth.signOut()
    .then(() => {
      document.getElementById('authPage').classList.remove('hidden');
      document.getElementById('appPages').classList.add('hidden');
    })
    .catch(error => {
      showModal('Error', error.message);
    });
});

// Check if user is already logged in
auth.onAuthStateChanged(user => {
  if (user) {
    // User is signed in
    document.getElementById('authPage').classList.add('hidden');
    document.getElementById('appPages').classList.remove('hidden');
    
    // Load user data
    loadProfile(user.uid);
    loadTournaments();
    loadTransactions(user.uid);
    loadMyTournaments(user.uid);
  } else {
    // User is signed out
    document.getElementById('authPage').classList.remove('hidden');
    document.getElementById('appPages').classList.add('hidden');
  }
});
</script>
</body>
</html>
